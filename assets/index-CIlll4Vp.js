var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-CLYd3JIB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const o=768;var a=s();const l=i(a);class r extends a.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}const n=class e extends a.Physics.Arcade.Sprite{static preload(t){if(e.textureLoaded)return;e.textureLoaded=!0;const s=t.add.graphics();s.fillStyle(16711680,1),s.fillCircle(10,10,10),s.generateTexture("ballTexture",20,20),s.destroy()}constructor(e,t,s){super(e,t,s,"ballTexture")}};t(n,"textureLoaded",!1);let c=n;class h{constructor(e){t(this,"wallStaticGroup"),this.wallStaticGroup=e.physics.add.staticGroup(),this.wallStaticGroup.create(e.sys.game.config.width/2,20,"wallTexture").setDisplaySize(e.sys.game.config.width-40,40).refreshBody(),this.wallStaticGroup.create(20,e.sys.game.config.height/2,"wallTexture").setDisplaySize(40,e.sys.game.config.height).refreshBody(),this.wallStaticGroup.create(e.sys.game.config.width-20,e.sys.game.config.height/2,"wallTexture").setDisplaySize(40,e.sys.game.config.height).refreshBody();const s=e.add.graphics();s.fillStyle(255,1),s.fillRect(0,0,10,10),s.generateTexture("wallTexture",10,10),s.destroy()}}class d{constructor(e){t(this,"scene"),t(this,"sprite"),t(this,"cursors"),t(this,"speed"),this.scene=e;const s=e.add.graphics();s.fillStyle(16777215,1),s.fillRect(0,0,100,20),s.generateTexture("paddleTexture",100,20),s.destroy();const i=e.sys.game.config.height-50;this.sprite=e.physics.add.sprite(e.sys.game.config.width/2,i,"paddleTexture"),this.sprite.setImmovable(!0),this.sprite.setCollideWorldBounds(!0),this.cursors=e.input.keyboard.createCursorKeys(),this.speed=500}update(){this.cursors.left.isDown?this.sprite.setVelocityX(-this.speed):this.cursors.right.isDown?this.sprite.setVelocityX(this.speed):this.scene.input.activePointer.isDown?this.scene.input.activePointer.x<this.scene.sys.game.config.width/2?this.sprite.setVelocityX(-this.speed):this.sprite.setVelocityX(this.speed):this.sprite.setVelocityX(0)}}const u=[{start:9356796,end:14730236},{start:16412826,end:16703808},{start:4450683,end:3733975},{start:16265874,end:7414522},{start:51711,end:9633437},{start:6717162,end:7752610}],g="PADDLE_WIDER",p="BALL_FASTER",f="EXTRA_SCORE",y="MULTI_BALL",m={[g]:e=>{const t=e.paddle.sprite;t.displayWidth=150,e.time.delayedCall(3e3,(()=>{150===t.displayWidth&&(t.displayWidth=100)}))},[p]:e=>{const t=e.balls[0].sprite,s=t.body.velocity.length();t.body.velocity.normalize().scale(1.5*s)},[f]:e=>{e.score+=100,e.uiManager.updateScore(e.score)},[y]:e=>{e.balls.getChildren().slice().forEach((t=>{if(t.active)for(let s=0;s<2;s++){const s=t.body.velocity.length(),i=Phaser.Math.DegToRad(Phaser.Math.RND.pick([-30,30])),o=t.body.velocity.angle()+i,a=e.physics.velocityFromAngle(Phaser.Math.RadToDeg(o),s);e._createBall(t.x,t.y,a.x,a.y)}}))}};function v(e,t,s){const i="gradientBackground",o=e.sys.game.config.width,a=e.sys.game.config.height;e.textures.exists(i)&&e.textures.remove(i);const r=e.add.graphics(),n=l.Display.Color.ValueToColor(t),c=l.Display.Color.ValueToColor(s);for(let h=0;h<a;h++){const e=l.Display.Color.Interpolate.ColorWithColor(n,c,a,h);r.fillStyle(e.color,1),r.fillRect(0,h,o,1)}r.generateTexture(i,o,a),r.destroy(),e.add.image(o/2,a/2,i).setDepth(-1)}class x extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i){super(e,t,s,`item_${i}`),this.itemType=i,e.add.existing(this),e.itemsGroup.add(this),this.setVelocityY(200)}}class S extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,o=null){switch(super(e,t,s,"blockTexture"),this.blockType=i,this.health=1,this.blockType=i,this.itemToDrop=o,this.health=1,this.blockType){case 1:default:this.setTint(65280),this.health=1;break;case 2:this.setTint(16747520),this.health=2;break;case 3:this.setTint(49151),this.health=1}e.add.existing(this)}hit(){this.health--,this.health<=0?(this.itemToDrop?(console.log(this.itemToDrop),new x(this.scene,this.x,this.y,this.itemToDrop)):new x(this.scene,this.x,this.y,y),this.destroy()):this.setTint(16711680)}}const b=[[0,1,{type:2,item:g},1,{type:2,item:y},1,0],[1,2,1,{type:1,item:f},1,2,1],[1,1,2,1,2,1,1],[0,1,1,2,1,1,0]],k=[[0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3],[1,1,2,2,2,1,1],[1,1,0,0,0,1,1],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0,3,3,3],[0,1,1,1,1,1,0,3,3,3],[0,1,1,1,1,1,0,3,3,3],[0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3],[0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3,0,1,1,1,1,1,0,3,3,3]],T=[[0,0,1,0,1,0,0],[0,1,1,1,1,1,0],[1,1,1,1,1,1,1],[1,1,1,0,1,1,1],[0,1,0,0,0,1,0]],w=[b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T,b,k,T];class L{static createBlocks(e){const t=e.physics.add.staticGroup(),s=w[e.selectedLevel-1];if(!s)return console.error(`Level ${e.selectedLevel} design not found!`),e.scene.start("MainMenu"),t;const i=s[0].length,o=(e.sys.game.config.width-100-5*(i-1))/i,a=o/2;e.textures.exists("blockTexture")&&e.textures.remove("blockTexture");const l=e.add.graphics();return l.fillStyle(16777215,1),l.fillRect(0,0,o,a),l.generateTexture("blockTexture",o,a),l.destroy(),s.forEach(((s,i)=>{s.forEach(((s,l)=>{if(s){const r=50+l*(o+5)+o/2,n=100+i*(a+5)+a/2;let c=s,h=null;"object"==typeof s&&(c=s.type,h=s.item);const d=new S(e,r,n,c,h);t.add(d)}}))})),t}}class _{constructor(e){t(this,"scene"),t(this,"scoreText"),this.scene=e,this.scoreText=null}createScoreText(e){this.scoreText=this.scene.add.text(16,16,`Score: ${e}`,{fontSize:"32px",fill:"#FFF",fontStyle:"bold"})}updateScore(e){this.scoreText.setText("Score: "+e)}showEndLevelUI(e){const t=this.scene.sys.game.config.width,s=this.scene.sys.game.config.height;this.scene.add.rectangle(0,0,t,s,0,.7).setOrigin(0);const i=e?"Level Clear!":"Game Over";this.scene.add.text(t/2,200,i,{fontSize:"64px",fill:"#fff",fontStyle:"bold"}).setOrigin(.5);const o=(e,s,i)=>{const o=this.scene.add.text(t/2,s,e,{fontSize:"32px",fill:"#0f0",backgroundColor:"#333",padding:{x:20,y:10}}).setOrigin(.5).setInteractive();o.on("pointerover",(()=>o.setStyle({fill:"#fff"}))),o.on("pointerout",(()=>o.setStyle({fill:"#0f0"}))),o.on("pointerdown",i)};e?(o("Next Level",350,(()=>{this.scene.scene.start("Game",{level:this.scene.selectedLevel+1})})),o("Main Menu",420,(()=>{this.scene.scene.start("MainMenu")}))):(o("Retry",350,(()=>{this.scene.scene.restart()})),o("Main Menu",420,(()=>{this.scene.scene.start("MainMenu")})))}}const P="myGameProgress",B={getUnlockedLevel(){const e=localStorage.getItem(P);return e?parseInt(e,10):1},saveProgress(e){e>64&&(e=65),e>this.getUnlockedLevel()&&(localStorage.setItem(P,e.toString()),console.log(`Progress saved! Unlocked up to level ${e}`))},resetProgress(){console.log("Progress reset!"),localStorage.removeItem(P)}};class E extends a.Scene{constructor(){super("Game"),t(this,"walls",null),t(this,"balls",null),t(this,"paddle",null),t(this,"blocksGroup",null),t(this,"itemsGroup",null),t(this,"uiManager",null),t(this,"score",0),t(this,"selectedLevel",1),t(this,"gameState","playing")}init(e){this.selectedLevel=e.level||1,this.score=0,this.gameState="playing"}preload(){c.preload(this)}create(){this._createBackground(),this._createCoreObjects(),this._createGroups(),this._createUI(),this._setupPhysics(),this.input.keyboard.on("keydown-C",this._forceLevelClear,this)}_createBall(e,t,s,i){if(this.balls.countActive(!0)>=100)return console.log("최대 공 개수(100개)에 도달하여 더 이상 생성되지 않습니다."),null;console.log(this.balls.countActive(!0));const o=this.balls.get(e,t);return o&&(o.setActive(!0),o.setVisible(!0),o.setCircle(10),o.setBounce(1),o.setVelocity(s,i)),o}update(){"playing"===this.gameState&&(this.paddle.update(),this._checkBallFall(),this._cleanupItems())}_createUI(){console.log("createUI"),this.uiManager=new _(this),this.uiManager.createScoreText(this.score)}_createBackground(){const e=Phaser.Math.RND.pick(u);v(this,e.start,e.end),function(e){if(e.textures.exists("item_PADDLE_WIDER"))return;const t=(t,s,i,o)=>{const a=e.add.renderTexture(0,0,30,30),l=e.add.graphics().fillStyle(s).fillRect(0,0,30,30),r=e.add.text(0,0,i,{fontSize:"20px",fill:o,fontStyle:"bold"}).setOrigin(.5);a.draw(l,0,0),a.draw(r,15,15),a.saveTexture(t),l.destroy(),r.destroy(),a.destroy()};t("item_PADDLE_WIDER",255,"W","#fff"),t("item_BALL_FASTER",16711680,"F","#fff"),t("item_EXTRA_SCORE",16776960,"$","#000"),t("item_MULTI_BALL",2146830,"M","#fff")}(this)}_createCoreObjects(){this.walls=new h(this),this.paddle=new d(this),this.balls=this.physics.add.group({classType:c}),this._createBall(this.sys.game.config.width/2,this.sys.game.config.height/2,400,300)}_createGroups(){this.blocksGroup=L.createBlocks(this),this.itemsGroup=this.physics.add.group()}_setupPhysics(){this.physics.add.collider(this.balls,this.walls.wallStaticGroup,this.handleBallWallCollision,null,this),this.physics.add.collider(this.balls,this.blocksGroup,this.hitBlock,null,this),this.physics.add.collider(this.balls,this.paddle.sprite,this.hitPaddle,null,this),this.physics.add.overlap(this.paddle.sprite,this.itemsGroup,this.collectItem,null,this)}_checkBallFall(){this.balls.getChildren().forEach((e=>{e.y>this.sys.game.config.height&&e.destroy()})),0===this.balls.countActive(!0)&&"playing"===this.gameState&&(this.gameState="gameOver",console.log(this.uiManager),this.uiManager.showEndLevelUI(!1))}_cleanupItems(){this.itemsGroup.getChildren().forEach((e=>{e.y>this.sys.game.config.height&&e.destroy()}))}hitBlock(e,t){this.sound.play("block_break"),t.hit(),this.score+=10,this.uiManager.updateScore(this.score),0===this.blocksGroup.countActive(!0)&&(console.log("All blocks cleared! Level Complete!"),this.gameState="cleared",B.saveProgress(this.selectedLevel+1),this.uiManager.showEndLevelUI(!0))}hitPaddle(e,t){this.sound.play("paddle_hit",{volume:.5})}collectItem(e,t){this.sound.play("item_get",{volume:.5});const s=m[t.itemType];s&&s(this),t.destroy()}handleBallWallCollision(e,t){this.sound.play("wall_hit",{volume:.01});const s=e.body.velocity.length();let i=e.body.velocity.angle()+Phaser.Math.DegToRad(Phaser.Math.FloatBetween(-10,10));this.physics.velocityFromAngle(Phaser.Math.RadToDeg(i),s,e.body.velocity)}_forceLevelClear(){"playing"===this.gameState&&(console.log("%c[DEBUG] Level Cleared by Force!","color: yellow; font-weight: bold;"),this.gameState="cleared",B.saveProgress(this.selectedLevel+1),this.uiManager.showEndLevelUI(!0))}}class M extends a.Scene{constructor(){super("GameOver")}create(){v(this,9356796,14730236),this.add.text(384,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.sound.play("ui_click"),this.scene.start("MainMenu")}))}}class C extends Phaser.Scene{constructor(){super("LevelSelect"),this.TOTAL_LEVELS=64,this.LEVELS_PER_PAGE=16,this.currentPage=1,this.totalPages=Math.ceil(this.TOTAL_LEVELS/this.LEVELS_PER_PAGE)}create(){const e=B.getUnlockedLevel();this.cameras.main.setBackgroundColor("#333"),this.add.text(this.cameras.main.width/2,60,"Select a Level",{fontSize:"48px",fill:"#fff",fontStyle:"bold"}).setOrigin(.5),this.pageText=this.add.text(this.cameras.main.width/2,this.cameras.main.height-60,"",{fontSize:"24px",fill:"#fff"}).setOrigin(.5),this.levelButtons=this.add.group(),this.prevButton=this.createNavButton(this.cameras.main.width/2-150,this.cameras.main.height-60,"< Prev",-1),this.nextButton=this.createNavButton(this.cameras.main.width/2+150,this.cameras.main.height-60,"Next >",1),this.drawLevelButtons(e),this.updateNavButtons()}drawLevelButtons(e){this.levelButtons.clear(!0,!0);const t=(this.currentPage-1)*this.LEVELS_PER_PAGE+1,s=(this.cameras.main.width-380)/2;for(let i=0;i<this.LEVELS_PER_PAGE;i++){const o=t+i;if(o>this.TOTAL_LEVELS)break;const a=o>e,l=s+i%4*100+40,r=150+100*Math.floor(i/4)+40,n=a?"🔒":o.toString(),c=a?"#666":"#fff",h=this.add.text(l,r,n,{fontSize:a?"48px":"32px",fill:c,backgroundColor:"#333",align:"center",fixedWidth:80,fixedHeight:80,padding:{top:a?10:15}}).setOrigin(.5);a?h.setAlpha(.6):(h.setInteractive(),h.setBackgroundColor("#555"),h.on("pointerover",(()=>h.setBackgroundColor("#777"))),h.on("pointerout",(()=>h.setBackgroundColor("#555"))),h.on("pointerdown",(()=>{this.scene.start("Game",{level:o})}))),this.levelButtons.add(h)}}createNavButton(e,t,s,i){const o=this.add.text(e,t,s,{fontSize:"24px",fill:"#fff"}).setOrigin(.5).setInteractive();return o.on("pointerover",(()=>o.setStyle({fill:"#0f0"}))),o.on("pointerout",(()=>o.setStyle({fill:"#fff"}))),o.on("pointerdown",(()=>{this.currentPage+=i;const e=B.getUnlockedLevel();this.drawLevelButtons(e),this.updateNavButtons()})),o}updateNavButtons(){this.prevButton.setVisible(this.currentPage>1),this.nextButton.setVisible(this.currentPage<this.totalPages),this.pageText.setText(`Page ${this.currentPage} / ${this.totalPages}`)}}class A extends a.Scene{constructor(){super("MainMenu")}create(){v(this,9356796,14730236),this.add.text(384,300,"Block Breaker",{fontFamily:"Arial Black",fontSize:50,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.add.text(384,460,"아무곳이나 클릭하여 시작",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{console.log("Start Button Clicked on Mobile!"),console.log("1. Current sound context state:",this.sound.context.state),"suspended"===this.sound.context.state&&this.sound.context.resume().then((()=>{console.log("2. Sound context resumed successfully!")})).catch((e=>console.error("3. Error resuming sound context:",e))),this.sound.play("ui_click"),this.scene.start("LevelSelect")}))}}class G extends a.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const e=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(t=>{e.width=4+460*t}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.audio("block_break","audio/Select_1.wav"),this.load.audio("paddle_hit","audio/Jump_1.wav"),this.load.audio("item_get","audio/Big_Egg_collect_1.wav"),this.load.audio("ui_click","audio/Fruit_collect_1.wav"),this.load.audio("wall_hit","audio/Hit_damage_1.wav")}create(){this.scene.start("MainMenu")}}const D={type:a.AUTO,width:o,height:1024,parent:"game-container",backgroundColor:"#028af8",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[r,G,A,C,E,M],physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}}};document.addEventListener("DOMContentLoaded",(()=>{new a.Game({...D,parent:"game-container"})}));
